# proj6-RV64N-user-level-interrupt

### 项目描述
在用户态直接响应中断，完成进程间通信将极大提高计算机系统中应用的性能。目前，用户态中断/异常的新硬件机制已经出现在2021年底发布的最新的x86-64 至强可扩展处理器（Sapphire Rapids）上，而且RISC-V也指定了对应的N扩展技术草案。Linux操作系统已经有对Sapphire Rapids用户态中断机制的内核级支持，相关应用的测试性能提高了1~2个数量级。

RISC-V 指令集是一种新兴的、开放的指令集体系结构，提供一系列标准化的指令集 “扩展”（extension），这也包括用户态中断/异常的 N 扩展技术草案，尽管其 Spec 尚未被确定并正式发布，但已经给 OS 开发者带来了不一样的思考。N 扩展规定了用户态特权级的一系列实现规范，主要支持了用户态处理中断、异常的机制。但该规范并没有具体的参考实现。

我们的目标是在RISC-V64 处理器上实现支持用户态中断/异常的N扩展规范：在硬件方面实现 N 扩展的全部逻辑；在软件方面，修改操作系统，在硬件机制的帮助下利用用户态中断完成一系列功能。参赛对的阶段性成果在2021年的全国大学生操作系统比赛中取得了很好的成绩。

### 所属赛道

2022全国大学生操作系统比赛的“OS功能设计”赛道

### 参赛要求

- 以小组为单位参赛，最多三人一个小组，且小组成员是来自同一所高校的本科生（2022年春季学期或之后本科毕业的大一~大四的学生）
- 如学生参加了多个项目，参赛学生选择一个自己参加的项目参与评奖
- 请遵循“2021全国大学生操作系统比赛”的章程和技术方案要求



### 项目导师

向勇

* github https://github.com/xyongcn
* email xyong@mail.tsinghua.edu.cn

陈渝

* github https://github.com/chyyuu
* email yuchen@mail.tsinghua.edu.cn


### 难度

中等



### 特征

- 兼容 RISC-V Privileged 规范 v1.11 版本，可在此基础上进行功能扩增
- 在RISC-V CPU上进行适配
- 硬件使用Chisel语言实现，软件不限



### 文档

- [RISC-V "N"扩展技术草案](http://www.five-embeddev.com/riscv-isa-manual/latest/n.html)
- [鲲筋烤参赛队的2021年OS比赛成果](https://gitlab.eduxiji.net/carbon/project325618-89175)



### License

- MIT license



## 预期目标

### 注意：下面的内容是建议内容，不要求必须全部完成。选择本项目的同学也可与导师联系，提出自己的新想法，如导师认可，可加入预期目标

在有初步N扩展规范的RISC-V CPU (FPGA)的基础上，进一步完成以下目标：


### 第一题：支持Sapphire Rapids（x86-64）用户态中断机制

* 扩展操作系统内核（如zCore），支持Sapphire Rapids（x86-64）用户态中断机制
* 改进Linux内核，优化Sapphire Rapids（x86-64）用户态中断机制
* 测试评价有/无用户态中断机制的情况下应用的性能差别
 
### 第二题：软硬件结合实现 N 扩展机制

* 自主选择操作系统，可以使用已有操作系统（如Linux，xv6，zCore等），也鼓励将其他开源/教学操作系统移植到RISC-V处理器上
* 阅读与理解RISC-V手册特权级部分，修改硬件代码实现对用户态中断的支持（N extension），并设计测试程序验证实现的正确性

### 第三题：探索用户态中断的应用场景

* 使用用户态中断实现所选操作系统的部分职能，可以探索的方向包括但不限于：
  * 用户态异常处理（如整数指令溢出、浮点异常等）
  * 用户态信号（Signal）处理
  * 用户态特权级支持下的异步垃圾回收机制
  * 用户态中断在计算机安全领域的应用

* 可以结合实际需求，在 N 扩展的框架下自主设计新的 CSR 寄存器及其相应的功能
* 撰写文档分析用户态中断在所选择的 OS 上体现出的设计与性能的优势，总结其对操作系统设计的启发意义
* 鼓励同学们探索用户态中断的更多使用场景

